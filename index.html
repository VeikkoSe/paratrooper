<html>

<head>
    <title>Paratrooper</title>

    <meta http-equiv="content-type" content="text/html; charset=utf8">
    <link href="js/jquery-ui-1.11.0.custom/jquery-ui.min.css" type="text/css" rel="stylesheet"/>


    <script type="text/javascript" src="js/gl/glMatrix-0.9.5.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.11.0.custom/external/jquery/jquery.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.11.0.custom/jquery-ui.min.js"></script>
    <script type="text/javascript" src="js/gl/webgl-utils.js"></script>
    <script type="text/javascript" src="js/gl/webgl-debug.js"></script>
    <script type="text/javascript" src="bower_components/traceur-runtime/traceur-runtime.js"></script>


    <script type="text/javascript" src="out/src/Character.js"></script>
    <script type="text/javascript" src="out/src/Medic.js"></script>
    <script type="text/javascript" src="out/src/Ranger.js"></script>
    <script type="text/javascript" src="out/src/Infiltrator.js"></script>
    <script type="text/javascript" src="out/src/Gunner.js"></script>
    <script type="text/javascript" src="out/src/Camera.js"></script>
    <script type="text/javascript" src="out/src/StateEngine.js"></script>
    <script type="text/javascript" src="out/src/InitState.js"></script>
    <script type="text/javascript" src="out/src/EndState.js"></script>
    <script type="text/javascript" src="out/src/PauseState.js"></script>
    <script type="text/javascript" src="out/src/GameState.js"></script>

    <script type="text/javascript" src="out/src/Texture.js"></script>
    <script type="text/javascript" src="out/src/Model.js"></script>
    <script type="text/javascript" src="out/src/Bullet.js"></script>
    <script type="text/javascript" src="out/src/Gun.js"></script>

    <script type="text/javascript" src="out/src/Game.js"></script>
    <script type="text/javascript" src="out/src/ActionMapper.js"></script>

</head>
<body >
<canvas id="canvas" width="1280" height="720"></canvas>

<div id="bottom" >
    <table>
        <tr>
            <td>light X:</td>
            <td id='slider-x-value' width='30px'>0</td>
            <td width="150px">
                <div id="slider-x"></div>
            </td>
        </tr>
        <tr>
            <td>light Y:</td>
            <td id="slider-y-value" width="30px">68</td>
            <td width="150px">
                <div id="slider-y"></div>
            </td>
        </tr>
        <tr>
            <td>light Z:</td>
            <td id="slider-z-value" width="30px">50</td>
            <td width="150px">
                <div id="slider-z"></div>
            </td>
        </tr>
    </table>

    <table>
        <tr>
            <td>Camera X:</td>
            <td id='cslider-x-value' width='30px'>0</td>
            <td width="150px">
                <div id="cslider-x"></div>
            </td>
        </tr>
        <tr>
            <td>Camera Y:</td>
            <td id="cslider-y-value" width="30px">0</td>
            <td width="150px">
                <div id="cslider-y"></div>
            </td>
        </tr>
        <tr>
            <td>Camera Z:</td>
            <td id="cslider-z-value" width="30px">0</td>
            <td width="150px">
                <div id="cslider-z"></div>
            </td>
        </tr>

        <tr>
            <td>Camera rot:</td>
            <td id="rotslider-x-value" width="30px">0</td>
            <td width="150px">
                <div id="rslider-x"></div>
            </td>
        </tr>
    </table>




</div>
<div id="debugarea"></div>
<script>

    $('#slider-x').slider({value: 0.0, min: -100, max: 100, step: 0.1, slide: updateLightPosition, change: updateLightPosition});
    $('#slider-y').slider({value: 68.0, min: -100, max: 100, step: 0.1, slide: updateLightPosition, change: updateLightPosition});
    $('#slider-z').slider({value: 50, min: -100, max: 100, step: 0.1, slide: updateLightPosition, change: updateLightPosition});

    $('#cslider-x').slider({value: 0, min: -100, max: 100, step: 0.1, slide: updateCameraPosition, change: updateCameraPosition});
    $('#cslider-y').slider({value: 0, min: -100, max: 100, step: 0.1, slide: updateCameraPosition, change: updateCameraPosition});
    $('#cslider-z').slider({value: 0, min: -100, max: 100, step: 0.1, slide: updateCameraPosition, change: updateCameraPosition});

    $('#rslider-x').slider({value: 0, min: 0, max: 360, step: 0.1, slide: updateRotation, change: updateRotation});

    var gl = null;
    var shaderProgram = null;
    var particleProgram = null;
    var currentlyPressedKeys = {};
    var game = null;
    var screenWidth = 155; //worldcoordinates
    var screenHeight = 90; //worldcoordinates
    var resolutionWidth = 1280;
    var resolutionHeight = 720;
    var texture = null;
    var camera = null;




    function printMessage(msg) {
        $('#debugarea').html(msg);
    }

    function initParticleShaders(id) {

        var program = gl.createProgram();

        getShader(id, program);

        gl.linkProgram(program);

        if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
            alert("Could not initialise shaders");
        }

        program.pointLifetimeAttribute = gl.getAttribLocation(program, "aLifetime");
        gl.enableVertexAttribArray(program.pointLifetimeAttribute);

        program.pointStartPositionAttribute = gl.getAttribLocation(program, "aStartPosition");
        gl.enableVertexAttribArray(program.pointStartPositionAttribute);

        program.pointEndPositionAttribute = gl.getAttribLocation(program, "aEndPosition");
        gl.enableVertexAttribArray(program.pointEndPositionAttribute);


        program.samplerUniform = gl.getUniformLocation(program, "sTexture");
        program.centerPositionUniform = gl.getUniformLocation(program, "uCenterPosition");
        program.colorUniform = gl.getUniformLocation(program, "uColor");
        program.timeUniform = gl.getUniformLocation(program, "uTime");


        return program;

    }

    function initShaders(id) {

        var program = gl.createProgram();

        getShader(id, program);

        gl.linkProgram(program);

        if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
            alert("Could not initialise shaders");
        }

        program.aVertexPosition = gl.getAttribLocation(program, "aVertexPosition");
        gl.enableVertexAttribArray(program.aVertexPosition);

        program.textureCoordAttribute = gl.getAttribLocation(program, "aTextureCoord");
        gl.enableVertexAttribArray(program.textureCoordAttribute);

        program.aVertexNormal = gl.getAttribLocation(program, "aVertexNormal");
        gl.enableVertexAttribArray(program.aVertexNormal);


        program.uPMatrix = gl.getUniformLocation(program, "uPMatrix");
        program.uMVMatrix = gl.getUniformLocation(program, "uMVMatrix");
        program.uNMatrix = gl.getUniformLocation(program, "uNMatrix");
        program.samplerUniform = gl.getUniformLocation(program, "uSampler");

        program.uMaterialShininess = gl.getUniformLocation(program, "uMaterialShininess");
        program.uAmbient = gl.getUniformLocation(program, "uAmbient");
        //shaderProgram.uMaterialDiffuse = gl.getUniformLocation(shaderProgram, "uMaterialDiffuse");
        //shaderProgram.uMaterialSpecular = gl.getUniformLocation(shaderProgram, "uMaterialSpecular");


        program.uLightPosition = gl.getUniformLocation(program, "uLightPosition");
        program.uLightAmbient = gl.getUniformLocation(program, "uLightAmbient");
        program.uLightDiffuse = gl.getUniformLocation(program, "uLightDiffuse");
        program.uLightSpecular = gl.getUniformLocation(program, "uLightSpecular");


        program.alphaUniform = gl.getUniformLocation(program, "uAlpha");
        program.useLightingUniform = gl.getUniformLocation(program, "uUseLighting");
        return program;

    }

    function getShader(id, program) {


        var vs_source = null, fs_source = null;
        $.ajax({
            async: false,
            url: './shaders/' + id + '-vs.shader',
            success: function (data) {

                vs_source = data;
            },
            dataType: 'html'
        });

        $.ajax({
            async: false,
            url: './shaders/' + id + '-fs.shader',
            success: function (data) {

                fs_source = data;
            },
            dataType: 'html'
        });
        var vsshader;
        var fsshader;

        fsshader = gl.createShader(gl.FRAGMENT_SHADER);
        gl.shaderSource(fsshader, fs_source);
        gl.compileShader(fsshader);
        if (!gl.getShaderParameter(fsshader, gl.COMPILE_STATUS)) {
            alert(gl.getShaderInfoLog(fsshader));
            return null;
        }

        vsshader = gl.createShader(gl.VERTEX_SHADER);
        gl.shaderSource(vsshader, vs_source);
        gl.compileShader(vsshader);
        if (!gl.getShaderParameter(vsshader, gl.COMPILE_STATUS)) {
            alert(gl.getShaderInfoLog(vsshader));
            return null;
        }

        gl.attachShader(program, vsshader);
        gl.attachShader(program, fsshader);

    }

    function logGLCall(functionName, args) {
        console.log("gl." + functionName + "(" +
                WebGLDebugUtils.glFunctionArgsToString(functionName, args) + ")");
    }

    function webGLStart() {

        var canvas = document.getElementById("canvas");


        camera = new Camera();
        game = new Game(canvas);


        //canvas.onmousedown = game.stateEngine.gameState.actionMapper.handleMouseDown;

        document.onmouseup = game.stateEngine.gameState.actionMapper.handleMouseUp;
        document.onmousemove = game.stateEngine.gameState.actionMapper.handleMouseMove;
        //Game.canvas.
        //canvas.addEventListener('mousedown', game.stateEngine.gameState.actionMapper.handleMouseDown, false);
        //canvas.addEventListener('mouseup', game.stateEngine.gameState.actionMapper.handleMouseUp, false);
        //canvas.addEventListener('mousemove', game.stateEngine.gameState.actionMapper.handleMouseUp, false);
        $("#canvas").bind( "mousedown", function(e){  game.stateEngine.gameState.actionMapper.handleMouseDown(e); } );

        //game.changeState("init");



    }


    function updateLightPosition() {
        var x = $('#slider-x').slider("value");
        var y = $('#slider-y').slider("value");
        var z = $('#slider-z').slider("value");
        //gl.uniform3f(shaderProgram.uLightPosition, x, y, z);
        $('#slider-x-value').html(x);
        $('#slider-y-value').html(y);
        $('#slider-z-value').html(z);
    }

    function updateCameraPosition() {
        var x = $('#cslider-x').slider("value");
        var y = $('#cslider-y').slider("value");
        var z = $('#cslider-z').slider("value");

        $('#cslider-x-value').html(x);
        $('#cslider-y-value').html(y);
        $('#cslider-z-value').html(z);
    }

    function updateRotation() {
        var x = $('#rslider-x').slider("value");


        $('#rotslider-x-value').html(x);

    }


    $( document ).ready( webGLStart );


</script>

</body>
</html>
